<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8">
<title>Рейтинг Nyapuru Club</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
<style>
html,body{height:100%;margin:0;font-family:"Inter",sans-serif;display:flex;flex-direction:column;align-items:center;justify-content:flex-start;text-align:center;background:white;color:#222;padding-top:20px;}
h1{margin-bottom:10px;}
table{border-collapse:collapse;width:90%;max-width:500px;margin-bottom:20px;}
th,td{border:1px solid #ccc;padding:8px 12px;vertical-align:middle;}
th{background:#f0f0f0;}
tr:nth-child(even){background:#fafafa;}
tr:nth-child(odd){background:#fff;}
.avatar{width:32px;height:32px;border-radius:50%;vertical-align:middle;margin-right:8px;}
button{padding:8px 16px;font-size:1em;cursor:pointer;}
</style>
<body>
<h1>Топ Будильщиков</h1>
<table id="rating-table">
<tr><th>№</th><th>Имя</th><th>Тыки</th></tr>
</table>
<button id="backBtn">Вернуться в профиль</button>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyAsEXre9p0gcOHFDtjcMUN-meh3T4hU_xE",
  authDomain: "nyapclub.firebaseapp.com",
  projectId: "nyapclub",
  storageBucket: "nyapclub.firebasestorage.app",
  messagingSenderId: "53370013681",
  appId: "1:53370013681:web:0f715a2ce01d69db65a650"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

const tg = window.Telegram.WebApp;
if (!tg.initDataUnsafe?.user) window.location.href = "index.html";
else {
  const table = document.getElementById("rating-table");
  const backBtn = document.getElementById("backBtn");

  backBtn.addEventListener("click", ()=>{ window.location.href="profile.html"; });

  db.collection("users").orderBy("clicks","desc").limit(100)
    .onSnapshot(snapshot => {
      table.innerHTML = '<tr><th>№</th><th>Имя</th><th>Тыки</th></tr>';
      let index = 1;
      snapshot.forEach(doc => {
        const data = doc.data();
        const avatar = data.photo_url ? `<img src="${data.photo_url}" class="avatar">` : `<img src="https://placekitten.com/32/32" class="avatar">`;
        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${index}</td><td>${avatar}${data.name}</td><td>${data.clicks}</td>`;
        table.appendChild(tr);
        index++;
      });
    });
}
</script>
</body>
</html>

