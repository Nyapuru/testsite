<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8">
<title>Профиль Nyapuru Club</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
<style>
html,body{height:100%;margin:0;font-family:"Inter",sans-serif;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;background:white;color:#222;}
#avatar{width:150px;height:150px;border-radius:50%;margin-top:20px;}
#stats{margin-top:10px;color:#555;}
a{display:block;margin-top:10px;color:#0066cc;text-decoration:none;}
a:hover{text-decoration:underline;}
</style>
</head>
<body>
<div id="content"><p>Загрузка...</p></div>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyAsEXre9p0gcOHFDtjcMUN-meh3T4hU_xE",
  authDomain: "nyapclub.firebaseapp.com",
  projectId: "nyapclub",
  storageBucket: "nyapclub.firebasestorage.app",
  messagingSenderId: "53370013681",
  appId: "1:53370013681:web:0f715a2ce01d69db65a650"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

const content = document.getElementById("content");
const tg = window.Telegram.WebApp;

if (!tg.initDataUnsafe?.user) {
  window.location.href = "index.html";
} else {
  const user = tg.initDataUnsafe.user;
  const userDoc = db.collection("users").doc(user.id.toString());

  // Подписка на изменения документа пользователя
  userDoc.onSnapshot(docSnap => {
    const data = docSnap.data() || {};
    const clicks = data.clicks || 0;
    const name = data.name || user.first_name;

    content.innerHTML = `
      <h1>Привет, ${name}!</h1>
      <img id="avatar" src="${user.photo_url || 'https://placekitten.com/200/200'}" alt="Аватар">
      <div id="stats">Ты пытался разбудить Няпа ${clicks} раз!</div>
      <a href="rating.html">Рейтинг</a>
    `;
  });
}
</script>
</body>
</html>
