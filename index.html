<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8">
<title>Nyapuru Club</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
<style>
html,body{height:100%;margin:0;font-family:"Inter",sans-serif;display:flex;flex-direction:column;align-items:center;justify-content:flex-start;background:white;color:#222;}
h1{margin-top:30px;}
#penguin{width:160px;height:160px;cursor:pointer;margin-top:50px;transition: transform 0.1s ease;user-select:none;}
#penguin:active{transform:scale(0.95);}
#counter{margin-top:10px;color:#999;font-size:0.9em;}
</style>
</head>
<body>
<h1 id="greet">Привет!</h1>
<img id="penguin" src="https://img.cryptorank.io/coins/pudgy_penguins1734444110427.png" alt="Пингвин">
<div id="counter">Кликов: 0 / 30</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyAsEXre9p0gcOHFDtjcMUN-meh3T4hU_xE",
  authDomain: "nyapclub.firebaseapp.com",
  projectId: "nyapclub",
  storageBucket: "nyapclub.firebasestorage.app",
  messagingSenderId: "53370013681",
  appId: "1:53370013681:web:0f715a2ce01d69db65a650"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

const tg = window.Telegram.WebApp;

if (!tg.initDataUnsafe?.user) {
  // Браузерная версия
  document.body.innerHTML = `
    <h1>Авторизуйтесь через Telegram</h1>
    <p>Сканируйте QR-код для доступа к приложению:</p>
    <img src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=https://t.me/nyapclub_bot" alt="QR код">
  `;
} else {
  tg.expand();
  const user = tg.initDataUnsafe.user;
  const greet = document.getElementById("greet");
  const counterEl = document.getElementById("counter");
  const penguin = document.getElementById("penguin");

  greet.textContent = `Привет, ${user.first_name}!`;

  let clicks = 0;
  counterEl.textContent = `Кликов: ${clicks} / 30`;

  const userDoc = db.collection("users").doc(user.id.toString());
  userDoc.set({ name: user.first_name, clicks: 0 }, { merge: true });

  penguin.addEventListener("click", () => {
    clicks++;
    counterEl.textContent = `Кликов: ${clicks} / 30`;
    userDoc.set({ clicks: clicks }, { merge: true });

    if (clicks >= 30) {
      window.location.href = "profile.html";
    }
  });
}
</script>
</body>
</html>
